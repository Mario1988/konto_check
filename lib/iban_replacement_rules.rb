require 'konto_check'
class IbanReplacementRules
  # old_blz => new_blz
  BLZ_REPLACEMENTS = { "10020200" => "50020200","20120200" => "50020200","25020200" => "50020200","30020500" => "50020200","51020000" => "50020200","55020000" => "50020200","60120200" => "50020200","70220200" => "50020200","86020200" => "50020200","68351976" => "68351557","50850049" => "50050000","40050000" => "30050000","44050000" => "30050000","10090603" => "30060601","12090640" => "30060601","20090602" => "30060601","21090619" => "30060601","23092620" => "30060601","25090608" => "30060601","26560625" => "30060601","27090618" => "30060601","28090633" => "30060601","29090605" => "30060601","33060616" => "30060601","35060632" => "30060601","36060610" => "30060601","37060615" => "30060601","39060630" => "30060601","40060614" => "30060601","44060604" => "30060601","50090607" => "30060601","50890634" => "30060601","51090636" => "30060601","52090611" => "30060601","53390635" => "30060601","54690623" => "30060601","55060831" => "30060601","57060612" => "30060601","57060612" => "30060601","59090626" => "30060601","60090609" => "30060601","66090621" => "30060601","67090617" => "30060601","68090622" => "30060601","70090606" => "30060601","70090606" => "30060601","75090629" => "30060601","76090613" => "30060601","77390628" => "30060601","79090624" => "30060601","50130100" => "50120383","50220200" => "50120383","70030800" => "50120383","35020030" => "36020030" ,"36220030" => "36020030" ,"36520030" => "36020030" ,"60250184" => "60050101","60450193" => "60050101","61050181" => "60050101","61150185" => "60050101","61450191" => "60050101","62050181" => "60050101","62250182" => "60050101","63050181" => "60050101","64050181" => "60050101","64150182" => "60050101","64450288" => "60050101","65050281" => "60050101","65350186" => "60050101","25050299" => "25050180","20050000" => "21050000","23050000" => "21050000","20110700" => "30010700","26691213" => "28590075","28591579" => "28590075","25090300" => "28590075","25621327" => "28020050","26520017" => "28020050","26521703" => "28020050","26522319" => "28020050","26620010" => "28020050","26621413" => "28020050","26720028" => "28020050","28021002" => "28020050","28021301" => "28020050","28021504" => "28020050","28021623" => "28020050","28021705" => "28020050","28021906" => "28020050","28022015" => "28020050","28022412" => "28020050","28022511" => "28020050","28022620" => "28020050","28022822" => "28020050","28023224" => "28020050","28023325" => "28020050","28220026" => "28020050","28222208" => "28020050","28222621" => "28020050","28320014" => "28020050","28321816" => "28020050","28420007" => "28020050","28421030" => "28020050","28520009" => "28020050","28521518" => "28020050","29121731" => "28020050","68051310" => "68052328","60651070" => "66650085","10120600" => "31010833","25020600" => "31010833","10120800" => "36010200","27010200" => "36010200","60020300" => "36010200","28252760" => "28550000"}
  # [old_blz, old_account] => [new_blz, new_account]
  ACCOUNT_REPLACEMENTS = {["79020076","0000009696"] => ["79020076","1490196966"],["10050000", "0000000135"]=>["10050000", "0990021440"],["60020290", "0500500500"] => ["60020290", "4340111112"],["60020290", "0000000502"] => ["60020290", "4340118001"], ["10050000", "0000001111"]=>["10050000", "6600012020"], ["10050000", "0000001900"]=>["10050000", "0920019005"], ["10050000", "0000007878"]=>["10050000", "0780008006"], ["10050000", "0000008888"]=>["10050000", "0250030942"], ["10050000", "0000009595"]=>["10050000", "1653524703"], ["10050000", "0000097097"]=>["10050000", "0013044150"], ["10050000", "0000112233"]=>["10050000", "0630025819"], ["10050000", "0000336666"]=>["10050000", "6604058903"], ["10050000", "0000484848"]=>["10050000", "0920018963"], ["30040000", "0000000036"]=>["30040000", "0261103600"], ["47880031", "0000000050"]=>["47880031", "0519899900"], ["47840065", "0000000050"]=>["47840065", "0150103000"], ["47840065", "0000000055"]=>["47840065", "0150103000"], ["70080000", "0000000094"]=>["70080000", "0928553201"], ["70040041", "0000000094"]=>["70040041", "0212808000"], ["47840065", "0000000099"]=>["47840065", "0150103000"], ["37080040", "0000000100"]=>["37080040", "0269100000"], ["38040007", "0000000100"]=>["38040007", "0119160000"], ["37080040", "0000000111"]=>["37080040", "0215022000"], ["51080060", "0000000123"]=>["51080060", "0012299300"], ["36040039", "0000000150"]=>["36040039", "0161620000"], ["68080030", "0000000202"]=>["68080030", "0416520200"], ["30040000", "0000000222"]=>["30040000", "0348010002"], ["38040007", "0000000240"]=>["38040007", "0109024000"], ["69240075", "0000000444"]=>["69240075", "0445520000"], ["60080000", "0000000502"]=>["60080000", "0901581400"], ["60040071", "0000000502"]=>["60040071", "0525950200"], ["55040022", "0000000555"]=>["55040022", "0002110500"], ["39080005", "0000000556"]=>["39080005", "0204655600"], ["39040013", "0000000556"]=>["39040013", "0106555600"], ["57080070", "0000000661"]=>["57080070", "0604101200"], ["26580070", "0000000700"]=>["26580070", "0710000000"], ["50640015", "0000000777"]=>["50640015", "0222222200"], ["30040000", "0000000999"]=>["30040000", "0123799900"], ["86080000", "0000001212"]=>["86080000", "0480375900"], ["37040044", "0000001888"]=>["37040044", "0212129101"], ["25040066", "0000001919"]=>["25040066", "0141919100"], ["10080000", "0000001987"]=>["10080000", "0928127700"], ["50040000", "0000002000"]=>["50040000", "0728400300"], ["20080000", "0000002222"]=>["20080000", "0903927200"], ["38040007", "0000003366"]=>["38040007", "0385333000"], ["37080040", "0000004004"]=>["37080040", "0233533500"], ["37080040", "0000004444"]=>["37080040", "0233000300"], ["43080083", "0000004630"]=>["43080083", "0825110100"], ["50080000", "0000006060"]=>["50080000", "0096736100"], ["10040000", "0000007878"]=>["10040000", "0267878700"], ["10080000", "0000008888"]=>["10080000", "0928126501"], ["50080000", "0000009000"]=>["50080000", "0026492100"], ["79080052", "0000009696"]=>["79080052", "0300021700"], ["79040047", "0000009696"]=>["79040047", "0680210200"], ["39080005", "0000009800"]=>["39080005", "0208457000"], ["50080000", "0000042195"]=>["50080000", "0900333200"], ["32040024", "0000047800"]=>["32040024", "0155515000"], ["37080040", "0000055555"]=>["37080040", "0263602501"], ["38040007", "0000055555"]=>["38040007", "0305555500"], ["50080000", "0000101010"]=>["50080000", "0090003500"], ["50040000", "0000101010"]=>["50040000", "0311011100"], ["37040044", "0000102030"]=>["37040044", "0222344400"], ["86080000", "0000121200"]=>["86080000", "0480375900"], ["66280053", "0000121212"]=>["66280053", "0625242400"], ["16080000", "0000123456"]=>["16080000", "0012345600"], ["29080010", "0000124124"]=>["29080010", "0107502000"], ["37080040", "0000182002"]=>["37080040", "0216603302"], ["12080000", "0000212121"]=>["12080000", "4050462200"], ["37080040", "0000300000"]=>["37080040", "0983307900"], ["37040044", "0000300000"]=>["37040044", "0300000700"], ["37080040", "0000333333"]=>["37080040", "0270330000"], ["38040007", "0000336666"]=>["38040007", "0105232300"], ["55040022", "0000343434"]=>["55040022", "0002179000"], ["85080000", "0000400000"]=>["85080000", "0459488501"], ["37080040", "0000414141"]=>["37080040", "0041414100"], ["38040007", "0000414141"]=>["38040007", "0108000100"], ["20080000", "0000505050"]=>["20080000", "0500100600"], ["37080040", "0000555666"]=>["37080040", "0055566600"], ["20080000", "0000666666"]=>["20080000", "0900732500"], ["30080000", "0000700000"]=>["30080000", "0800005000"], ["70080000", "0000700000"]=>["70080000", "0750055500"], ["70080000", "0000900000"]=>["70080000", "0319966601"], ["37080040", "0000909090"]=>["37080040", "0269100000"], ["38040007", "0000909090"]=>["38040007", "0001191600"], ["70080000", "0000949494"]=>["70080000", "0575757500"], ["70080000", "0001111111"]=>["70080000", "0448060000"], ["70040041", "0001111111"]=>["70040041", "0152140000"], ["10080000", "0001234567"]=>["10080000", "0920192001"], ["38040007", "0001555555"]=>["38040007", "0258266600"], ["76040061", "0002500000"]=>["76040061", "0482146800"], ["16080000", "0003030400"]=>["16080000", "4205227110"], ["37080040", "0005555500"]=>["37080040", "0263602501"], ["75040062", "0006008833"]=>["75040062", "0600883300"], ["12080000", "0007654321"]=>["12080000", "0144000700"], ["70080000", "0007777777"]=>["70080000", "0443540000"], ["70040041", "0007777777"]=>["70040041", "0213600000"], ["64140036", "0008907339"]=>["64140036", "0890733900"], ["70080000", "0009000000"]=>["70080000", "0319966601"], ["61080006", "0009999999"]=>["61080006", "0202427500"], ["12080000", "0012121212"]=>["12080000", "4101725100"], ["29080010", "0012412400"]=>["29080010", "0107502000"], ["34280032", "0014111935"]=>["34280032", "0645753800"], ["38040007", "0043434343"]=>["38040007", "0118163500"], ["30080000", "0070000000"]=>["30080000", "0800005000"], ["70080000", "0070000000"]=>["70080000", "0750055500"], ["44040037", "0111111111"]=>["44040037", "0320565500"], ["70040041", "0400500500"]=>["70040041", "0400500500"], ["60080000", "0500500500"]=>["60080000", "0901581400"], ["60040071", "0500500500"]=>["60040071", "0512700600"], ["70150000", "0001111111"]=>["70150000", "0020228888"], ["70150000", "0007777777"]=>["70150000", "0903286003"], ["70150000", "0034343434"]=>["70150000", "1000506517"], ["70150000", "0000070000"]=>["70150000", "0018180018"], ["37050198", "0000000111"]=>["37050198", "0000001115"], ["37050198", "0000000221"]=>["37050198", "0023002157"], ["37050198", "0000001888"]=>["37050198", "0018882068"], ["37050198", "0000002006"]=>["37050198", "1900668508"], ["37050198", "0000002626"]=>["37050198", "1900730100"], ["37050198", "0000003004"]=>["37050198", "1900637016"], ["37050198", "0000003636"]=>["37050198", "0023002447"], ["37050198", "0000004000"]=>["37050198", "0000004028"], ["37050198", "0000004444"]=>["37050198", "0000017368"], ["37050198", "0000005050"]=>["37050198", "0000073999"], ["37050198", "0000008888"]=>["37050198", "1901335750"], ["37050198", "0000030000"]=>["37050198", "0009992959"], ["37050198", "0000043430"]=>["37050198", "1901693331"], ["37050198", "0000046664"]=>["37050198", "1900399856"], ["37050198", "0000055555"]=>["37050198", "0034407379"], ["37050198", "0000102030"]=>["37050198", "1900480466"], ["37050198", "0000151515"]=>["37050198", "0057762957"], ["37050198", "0000222222"]=>["37050198", "0002222222"], ["37050198", "0000300000"]=>["37050198", "0009992959"], ["37050198", "0000333333"]=>["37050198", "0000033217"], ["37050198", "0000414141"]=>["37050198", "0000092817"], ["37050198", "0000606060"]=>["37050198", "0000091025"], ["37050198", "0000909090"]=>["37050198", "0000090944"], ["37050198", "0002602024"]=>["37050198", "0005602024"], ["37050198", "0003000000"]=>["37050198", "0009992959"], ["37050198", "0007777777"]=>["37050198", "0002222222"], ["37050198", "0008090100"]=>["37050198", "0000038901"], ["37050198", "0014141414"]=>["37050198", "0043597665"], ["37050198", "0015000023"]=>["37050198", "0015002223"], ["37050198", "0015151515"]=>["37050198", "0057762957"], ["37050198", "0022222222"]=>["37050198", "0002222222"], ["37050198", "0200820082"]=>["37050198", "1901783868"], ["37050198", "0222220022"]=>["37050198", "0002222222"], ["50050201", "0000002000"]=>["50050201", "0000222000"], ["50020201", "0000800000"]=>["50020201", "0000180802"], ["32050000", "0000001000"]=>["32050000", "0008010001"], ["32050000", "0000047800"]=>["32050000", "0000047803"], ["37060193", "0000000556"]=>["37060193", "0000101010"], ["37060193", "0000000888"]=>["37060193", "0031870011"], ["37060193", "0000004040"]=>["37060193", "4003600101"], ["37060193", "0000005826"]=>["37060193", "1015826017"], ["37060193", "0000025000"]=>["37060193", "0025000110"], ["37060193", "0000393393"]=>["37060193", "0033013019"], ["37060193", "0000444555"]=>["37060193", "0032230016"], ["37060193", "0000603060"]=>["37060193", "6002919018"], ["37060193", "0002120041"]=>["37060193", "0002130041"], ["37060193", "0080868086"]=>["37060193", "4007375013"], ["37060193", "0400569017"]=>["37060193", "4000569017"], ["37160087", "0000300000"]=>["37160087", "0018128012"], ["38060186", "0000000100"]=>["38060186", "2009090013"], ["38060186", "0000000111"]=>["38060186", "2111111017"], ["38060186", "0000000240"]=>["38060186", "2100240010"], ["38060186", "0000004004"]=>["38060186", "2204004016"], ["38060186", "0000004444"]=>["38060186", "2044444014"], ["38060186", "0000006060"]=>["38060186", "2016060014"], ["38060186", "0000102030"]=>["38060186", "1102030016"], ["38060186", "0000333333"]=>["38060186", "2033333016"], ["38060186", "0000909090"]=>["38060186", "2009090013"], ["38060186", "0050005000"]=>["38060186", "5000500013"], ["39060180", "0000000556"]=>["39060180", "0120440110"], ["39060180", "5435435430"]=>["39060180", "0543543543"], ["39060180", "0000002157"]=>["39060180", "0121787016"], ["39060180", "0000009800"]=>["39060180", "0120800019"], ["39060180", "0000202050"]=>["39060180", "1221864014"], ["50070010", "0000009999"]=>["50070010", "0092777202"], ["43060967", "0001111111"]=>["43060967", "2222200000"], ["26590025", "0000000700"]=>["26590025", "1000700800"], ["36060295", "0000000094"]=>["36060295", "0000001694"], ["36060295", "0000000248"]=>["36060295", "0000017248"], ["36060295", "0000000345"]=>["36060295", "0000017345"], ["36060295", "0000000400"]=>["36060295", "0000014400"], ["35060190", "0000005511"]=>["35060190", "0008090100"], ["70020270", "0000022222"]=>["70020270", "5803435253"], ["70020270", "0001111111"]=>["70020270", "0039908140"], ["70020270", "0000000094"]=>["70020270", "0002711931"], ["70020270", "0007777777"]=>["70020270", "5800522694"], ["70020270", "0000055555"]=>["70020270", "5801800000"], ["68050101", "0000000202"]=>["68050101", "0002282022"], ["30060010", "0000000036"]=>["30060010", "0002310113"], ["30060010", "0000000936"]=>["30060010", "0002310113"], ["30060010", "0000000999"]=>["30060010", "0001310113"], ["30060010", "0000006060"]=>["30060010", "0000160602"], ["40060000", "0000000036"]=>["40060000", "0002310113"], ["40060000", "0000000936"]=>["40060000", "0002310113"], ["40060000", "0000000999"]=>["40060000", "0001310113"], ["40060000", "0000006060"]=>["40060000", "0000160602"], ["57060000", "0000000036"]=>["57060000", "0002310113"], ["57060000", "0000000936"]=>["57060000", "0002310113"], ["57060000", "0000000999"]=>["57060000", "0001310113"], ["57060000", "0000006060"]=>["57060000", "0000160602"], ["60050101", "0000000333"]=>["60050101", "7832500881"], ["60050101", "0000000502"]=>["60050101", "0001108884"], ["60050101", "0500500500"]=>["60050101", "0005005000"], ["60050101", "0502502502"]=>["60050101", "0001108884"], ["67220020", "5308810004"]=>["60050101", "0002662604"], ["67220020", "5308810000"]=>["60050101", "0002659600"], ["67020020", "5203145700"]=>["60050101", "7496510994"], ["69421020", "6208908100"]=>["60050101", "7481501341"], ["66620020", "4840404000"]=>["60050101", "7498502663"], ["64120030", "1201200100"]=>["60050101", "7477501214"], ["64020030", "1408050100"]=>["60050101", "7469534505"], ["63020130", "1112156300"]=>["60050101", "0004475655"], ["62030050", "7002703200"]=>["60050101", "7406501175"], ["69220020", "6402145400"]=>["60050101", "7485500252"], ["55050000", "0000035000"]=>["60050101", "7401555913"], ["55050000", "0119345106"]=>["60050101", "7401555906"], ["55050000", "0000000908"]=>["60050101", "7401507480"], ["55050000", "0000000901"]=>["60050101", "7401507497"], ["55050000", "0000000910"]=>["60050101", "7401507466"], ["55050000", "0000035100"]=>["60050101", "7401555913"], ["55050000", "0000000902"]=>["60050101", "7401507473"], ["55050000", "0000044000"]=>["60050101", "7401555872"], ["55050000", "0110132511"]=>["60050101", "7401550530"], ["55050000", "0110024270"]=>["60050101", "7401501266"], ["55050000", "0000003500"]=>["60050101", "7401555913"], ["55050000", "0110050002"]=>["60050101", "7401502234"], ["55050000", "0055020100"]=>["60050101", "7401555872"], ["55050000", "0110149226"]=>["60050101", "7401512248"], ["60020030", "1047444300"]=>["60050101", "7871538395"], ["60020030", "1040748400"]=>["60050101", "0001366705"], ["60020030", "1000617900"]=>["60050101", "0002009906"], ["60020030", "1003340500"]=>["60050101", "0002001155"], ["60020030", "1002999900"]=>["60050101", "0002588991"], ["60020030", "1004184600"]=>["60050101", "7871513509"], ["60020030", "1000919900"]=>["60050101", "7871531505"], ["60020030", "1054290000"]=>["60050101", "7871521216"], ["60050000", "0000001523"]=>["60050101", "0001364934"], ["60050000", "0000002811"]=>["60050101", "0001367450"], ["60050000", "0000002502"]=>["60050101", "0001366705"], ["60050000", "0000250412"]=>["60050101", "7402051588"], ["60050000", "0000003009"]=>["60050101", "0001367924"], ["60050000", "0000004596"]=>["60050101", "0001372809"], ["60050000", "0000003080"]=>["60050101", "0002009906"], ["60050000", "0001029204"]=>["60050101", "0002782254"], ["60050000", "0000003002"]=>["60050101", "0001367924"], ["60050000", "0000123456"]=>["60050101", "0001362826"], ["60050000", "0000002535"]=>["60050101", "0001119897"], ["60050000", "0000005500"]=>["60050101", "0001375703"], ["66020020", "4002401000"]=>["60050101", "7495500967"], ["66020020", "4000604100"]=>["60050101", "0002810030"], ["66020020", "4002015800"]=>["60050101", "7495530102"], ["66020020", "4003746700"]=>["60050101", "7495501485"], ["66050000", "0000086567"]=>["60050101", "0001364934"], ["66050000", "0000086345"]=>["60050101", "7402046641"], ["66050000", "0000085304"]=>["60050101", "7402045439"], ["66050000", "0000085990"]=>["60050101", "7402051588"], ["86050000", "0000001016"]=>["60050101", "7461500128"], ["86050000", "0000003535"]=>["60050101", "7461505611"], ["86050000", "0000002020"]=>["60050101", "7461500018"], ["86050000", "0000004394"]=>["60050101", "7461505714"], ["10060237", "0000000500"]=>["10060237", "0000500500"], ["10060237", "0000000502"]=>["10060237", "0000502502"], ["10060237", "0000018067"]=>["10060237", "0000180670"], ["10060237", "0000484848"]=>["10060237", "0000484849"], ["10060237", "0000636306"]=>["10060237", "0000063606"], ["10060237", "0000760440"]=>["10060237", "0000160440"], ["10060237", "0001018413"]=>["10060237", "0010108413"], ["10060237", "0002601577"]=>["10060237", "0026015776"], ["10060237", "0005005000"]=>["10060237", "0000500500"], ["10060237", "0010796740"]=>["10060237", "0010796743"], ["10060237", "0011796740"]=>["10060237", "0011796743"], ["10060237", "0012796740"]=>["10060237", "0012796743"], ["10060237", "0013796740"]=>["10060237", "0013796743"], ["10060237", "0014796740"]=>["10060237", "0014796743"], ["10060237", "0015796740"]=>["10060237", "0015796743"], ["10060237", "0016307000"]=>["10060237", "0163107000"], ["10060237", "0016610700"]=>["10060237", "0166107000"], ["10060237", "0016796740"]=>["10060237", "0016796743"], ["10060237", "0017796740"]=>["10060237", "0017796743"], ["10060237", "0018796740"]=>["10060237", "0018796743"], ["10060237", "0019796740"]=>["10060237", "0019796743"], ["10060237", "0020796740"]=>["10060237", "0020796743"], ["10060237", "0021796740"]=>["10060237", "0021796743"], ["10060237", "0022796740"]=>["10060237", "0022796743"], ["10060237", "0023796740"]=>["10060237", "0023796743"], ["10060237", "0024796740"]=>["10060237", "0024796743"], ["10060237", "0025796740"]=>["10060237", "0025796743"], ["10060237", "0026610700"]=>["10060237", "0266107000"], ["10060237", "0026796740"]=>["10060237", "0026796743"], ["10060237", "0027796740"]=>["10060237", "0027796743"], ["10060237", "0028796740"]=>["10060237", "0028796743"], ["10060237", "0029796740"]=>["10060237", "0029796743"], ["10060237", "0045796740"]=>["10060237", "0045796743"], ["10060237", "0050796740"]=>["10060237", "0050796743"], ["10060237", "0051796740"]=>["10060237", "0051796743"], ["10060237", "0052796740"]=>["10060237", "0052796743"], ["10060237", "0053796740"]=>["10060237", "0053796743"], ["10060237", "0054796740"]=>["10060237", "0054796743"], ["10060237", "0055796740"]=>["10060237", "0055796743"], ["10060237", "0056796740"]=>["10060237", "0056796743"], ["10060237", "0057796740"]=>["10060237", "0057796743"], ["10060237", "0058796740"]=>["10060237", "0058796743"], ["10060237", "0059796740"]=>["10060237", "0059796743"], ["10060237", "0060796740"]=>["10060237", "0060796743"], ["10060237", "0061796740"]=>["10060237", "0061796743"], ["10060237", "0062796740"]=>["10060237", "0062796743"], ["10060237", "0063796740"]=>["10060237", "0063796743"], ["10060237", "0064796740"]=>["10060237", "0064796743"], ["10060237", "0065796740"]=>["10060237", "0065796743"], ["10060237", "0066796740"]=>["10060237", "0066796743"], ["10060237", "0067796740"]=>["10060237", "0067796743"], ["10060237", "0068796740"]=>["10060237", "0068796743"], ["10060237", "0069796740"]=>["10060237", "0069796743"], ["10060237", "1761070000"]=>["10060237", "0176107000"], ["10060237", "2210531180"]=>["10060237", "0201053180"], ["21060237", "0000000500"]=>["21060237", "0000500500"], ["21060237", "0000000502"]=>["21060237", "0000502502"], ["21060237", "0000018067"]=>["21060237", "0000180670"], ["21060237", "0000484848"]=>["21060237", "0000484849"], ["21060237", "0000636306"]=>["21060237", "0000063606"], ["21060237", "0000760440"]=>["21060237", "0000160440"], ["21060237", "0001018413"]=>["21060237", "0010108413"], ["21060237", "0002601577"]=>["21060237", "0026015776"], ["21060237", "0005005000"]=>["21060237", "0000500500"], ["21060237", "0010796740"]=>["21060237", "0010796743"], ["21060237", "0011796740"]=>["21060237", "0011796743"], ["21060237", "0012796740"]=>["21060237", "0012796743"], ["21060237", "0013796740"]=>["21060237", "0013796743"], ["21060237", "0014796740"]=>["21060237", "0014796743"], ["21060237", "0015796740"]=>["21060237", "0015796743"], ["21060237", "0016307000"]=>["21060237", "0163107000"], ["21060237", "0016610700"]=>["21060237", "0166107000"], ["21060237", "0016796740"]=>["21060237", "0016796743"], ["21060237", "0017796740"]=>["21060237", "0017796743"], ["21060237", "0018796740"]=>["21060237", "0018796743"], ["21060237", "0019796740"]=>["21060237", "0019796743"], ["21060237", "0020796740"]=>["21060237", "0020796743"], ["21060237", "0021796740"]=>["21060237", "0021796743"], ["21060237", "0022796740"]=>["21060237", "0022796743"], ["21060237", "0023796740"]=>["21060237", "0023796743"], ["21060237", "0024796740"]=>["21060237", "0024796743"], ["21060237", "0025796740"]=>["21060237", "0025796743"], ["21060237", "0026610700"]=>["21060237", "0266107000"], ["21060237", "0026796740"]=>["21060237", "0026796743"], ["21060237", "0027796740"]=>["21060237", "0027796743"], ["21060237", "0028796740"]=>["21060237", "0028796743"], ["21060237", "0029796740"]=>["21060237", "0029796743"], ["21060237", "0045796740"]=>["21060237", "0045796743"], ["21060237", "0050796740"]=>["21060237", "0050796743"], ["21060237", "0051796740"]=>["21060237", "0051796743"], ["21060237", "0052796740"]=>["21060237", "0052796743"], ["21060237", "0053796740"]=>["21060237", "0053796743"], ["21060237", "0054796740"]=>["21060237", "0054796743"], ["21060237", "0055796740"]=>["21060237", "0055796743"], ["21060237", "0056796740"]=>["21060237", "0056796743"], ["21060237", "0057796740"]=>["21060237", "0057796743"], ["21060237", "0058796740"]=>["21060237", "0058796743"], ["21060237", "0059796740"]=>["21060237", "0059796743"], ["21060237", "0060796740"]=>["21060237", "0060796743"], ["21060237", "0061796740"]=>["21060237", "0061796743"], ["21060237", "0062796740"]=>["21060237", "0062796743"], ["21060237", "0063796740"]=>["21060237", "0063796743"], ["21060237", "0064796740"]=>["21060237", "0064796743"], ["21060237", "0065796740"]=>["21060237", "0065796743"], ["21060237", "0066796740"]=>["21060237", "0066796743"], ["21060237", "0067796740"]=>["21060237", "0067796743"], ["21060237", "0068796740"]=>["21060237", "0068796743"], ["21060237", "0069796740"]=>["21060237", "0069796743"], ["21060237", "1761070000"]=>["21060237", "0176107000"], ["21060237", "2210531180"]=>["21060237", "0201053180"]} 
  # blz => ignore_reg_exp
  IGNORE = { "72020700" => /\A\d{7}86\d{1}\Z/i, "72020700" => /\A\d{7}6\d{2}\Z/i, "51010800" => /\A6161604670\Z/i, "50040033" => /\A.*\Z/i, "10020000" => /\A.*\Z/i}
  # [blz, account]
  NO_CHECK = [["32060362","0000003333"], ["32060362","0000004444"], ["13091054", "0001718190"], ["13091054", "0022000225"], ["13091054", "0049902271"], ["13091054", "0049902280"], ["13091054", "0101680029"], ["13091054", "0104200028"], ["13091054", "0106200025"], ["13091054", "0108000171"], ["13091054", "0108000279"], ["13091054", "0108001364"], ["13091054", "0108001801"], ["13091054", "0108002514"], ["13091054", "0300008542"], ["13091054", "9130099995"], ["13091054", "9130500002"], ["13091054", "9131100008"], ["13091054", "9131600000"], ["13091054", "9131610006"], ["13091054", "9132200006"], ["13091054", "9132400005"], ["13091054", "9132600004"], ["13091054", "9132700017"], ["13091054", "9132700025"], ["13091054", "9132700033"], ["13091054", "9132700041"], ["13091054", "9133200700"], ["13091054", "9133200735"], ["13091054", "9133200743"], ["13091054", "9133200751"], ["13091054", "9133200786"], ["13091054", "9133200808"], ["13091054", "9133200816"], ["13091054", "9133200824"], ["13091054", "9133200832"], ["13091054", "9136700003"], ["13091054", "9177300010"], ["13091054", "9177300060"], ["13091054", "9198100002"], ["13091054", "9198200007"], ["13091054", "9198200104"], ["13091054", "9198300001"], ["13091054", "9331300141"], ["13091054", "9331300150"], ["13091054", "9331401010"], ["13091054", "9331401061"], ["13091054", "9349010000"], ["13091054", "9349100000"], ["13091054", "9360500001"], ["13091054", "9364902007"], ["13091054", "9366101001"], ["13091054", "9366104000"], ["13091054", "9370620030"], ["13091054", "9370620080"], ["13091054", "9371900010"], ["13091054", "9373600005"], ["13091054", "9402900021"], ["13091054", "9605110000"], ["13091054", "9614001000"], ["13091054", "9615000016"], ["13091054", "9615010003"], ["13091054", "9618500036"], ["13091054", "9631020000"], ["13091054", "9632600051"], ["13091054", "9632600060"], ["13091054", "9635000012"], ["13091054", "9635000020"], ["13091054", "9635701002"], ["13091054", "9636010003"], ["13091054", "9636013002"], ["13091054", "9636016001"], ["13091054", "9636018004"], ["13091054", "9636019000"], ["13091054", "9636022001"], ["13091054", "9636024004"], ["13091054", "9636025000"], ["13091054", "9636027003"], ["13091054", "9636028000"], ["13091054", "9636045001"], ["13091054", "9636048000"], ["13091054", "9636051001"], ["13091054", "9636053004"], ["13091054", "9636120003"], ["13091054", "9636140004"], ["13091054", "9636150000"], ["13091054", "9636320002"], ["13091054", "9636700000"], ["13091054", "9638120000"], ["13091054", "9639401100"], ["13091054", "9639801001"], ["13091054", "9670010004"], ["13091054", "9680610000"], ["13091054", "9705010002"], ["13091054", "9705403004"], ["13091054", "9705404000"], ["13091054", "9705509996"], ["13091054", "9707901001"], ["13091054", "9736010000"], ["13091054", "9780100050"], ["13091054", "9791000030"], ["13091054", "9990001003"], ["13091054", "9990001100"], ["13091054", "9990002000"], ["13091054", "9990004002"], ["13091054", "9991020001"], ["13091054", "9991040002"], ["13091054", "9991060003"], ["13091054", "9999999993"], ["13091054", "9999999994"], ["13091054", "9999999995"], ["13091054", "9999999996"], ["13091054", "9999999997"], ["13091054", "9999999998"], ["13091054", "9999999999"]]


  # skip account validation

  def self.replace(blz, account)
    blz, account = account_replacement(blz, account)
    blz = blz_replacement(blz)
    blz, account = account_replacement(blz, account)
    raise "For this account there is no IBAN" if ignore?(blz, account)
    blz, account = sparkasse_zell_im_wiesental(blz, account)
    blz, account = societe_generale_blz(blz, account)
    blz, account = bausparkasse_schwaebisch_hall(blz, account)
    blz, account = deutsche_bundesbank(blz, account)
    blz, account = wgz_bank(blz, account)
    blz, account = landesbank_baden_wuerttemberg(blz, account)
    blz, account = hsh_nordbank(blz, account)
    blz, account = unicredit(blz, account)
    blz, account = commerzbank(blz, account)
    blz, account = method_13_adeptions(blz, account)
    blz, account = method_63_adeptions(blz, account)
    blz, account = method_76_adeptions(blz, account)
    blz, account
  end

  def skip_account_check?(blz, account)
    NO_CHECK.include?([blz, account])
  end

  private

  def self.ignore?(blz, account)
    matching = IGNORE[blz]
    return false unless matching
    matchig.match(account)
  end

  def self.blz_replacement(blz)
    blz = BLZ_REPLACEMENTS[blz] || blz
    blz
  end

  def self.account_replacement(blz, account)
    new_account = ACCOUNT_REPLACEMENTS[[blz, account]]
    return new_account[0], new_account[1] if new_account
    blz, account
  end

  # 0009
  # Bei Kontonummern der ehemaligen Sparkasse Zell im Wiesental (BLZ: 683 519 76),
  # die bei zehnstelliger Darstellung mit 1116 beginnen, werden die linken vier 
  # Stellen durch den Wert 3047 ersetzt.
  def self.sparkasse_zell_im_wiesental(blz, account)
    if blz == "68351976" && account.length == 10
      if account.start_with?("1116")
        account = "3047" + account[4..-1]
      end
    end
    blz, account
  end

  # 002900 Societe Generale BLZ 51210800
  # Bei der Ermittlung einer IBAN aus Kontonummer und BLZ sind in Abweichung zu der Standard IBAN-Regel folgende Besonderheiten zu beachten:
  # 10-stellige Kontennummern (d. h. die 1. Ziffer der Kontonummer ist ungleich "0"), die in Position 4 eine "0" enthalten, können nicht 1:1 in eine gültige IBAN konvertiert werden.
  # In diesen Fällen wird die korrekte Kontonummer für IBAN gebildet indem die 4. Ziffer (die "0") entfernt wird. Man erhält eine 9-stellige Konto-Nummer, die 1. Ziffer der Kon- tonummer in der IBAN ist damit implizit eine "0".
  # Beispiele für Kontonummern die konvertiert werden müssen: - 2600123456 wird konvertiert in 0260123456
  # - 1410123456 wird konvertiert in 0141123456
  def self.societe_generale_blz(blz, account)
    if blz == "51210800" && account.length == 10 && account[0] != '0'
      account = account[0..2] + account [4..-1]
    end
    blz, account
  end

  # 0041
  # Bei Bankverbindungen mit der Bankleitzahl 622 200 00 ist generell die IBAN = DE96 5006 0400 0000 0114 04 
  def self.bausparkasse_schwaebisch_hall(blz, account)
    if blz == "62220000"
      blz = "50060400"
      account = "0000011404"
    end
    blz, account
  end

  # 004200 Deutsche Bundesbank
  # Bei der Ermittlung einer IBAN aus Kontonummer und BLZ sind in Abweichung zu der Standard IBAN-Regel folgende Besonderheiten zu beachten:
  #  Die Kontonummern der Deutschen Bundesbank, die für die IBAN-Ermittlung freige- geben sind, sind immer achtstellig.
  #  Die Kontonummer muss an der 4. Stelle immer gleich „0“ sein (Beispiel: 100 0 1000). Davon abweichend ist die IBAN-Ermittlung für die Kontonummern
  # o 504 6 2000 bis 504 6 3999 sowie o 504 6 9000 bis 504 6 9999
  # mit der Standard-IBAN-Regel möglich
  #  Konten ohne IBAN-Berechnung
  # o nnn 0 0000 bis nnn 0 0999
  def self.deutsche_bundesbank(blz, account)
    blzs_bundesbank = ["10000000", "13000000", "15000000", "20000000", "21000000", "23000000", "25000000", "26000000", "26500000", "28000000", "29000000", "30000000", "36000000", "37000000", "43000000", "44000000", "45000000", "48000000", "50000000", "50400000", "51300000", "54500000", "55000000", "57000000", "59000000", "60000000", "63000000", "64000000", "66000000", "68000000", "69400000", "70000000", "72000000", "75000000", "76000000", "77300000", "79000000", "81000000", "82000000", "85000000", "86000000", "87000000"]
    if blzs_bundesbank.include?(blz) && account[0..1] = "00"
      raise "For this account there is no IBAN (Bundesbank 1)" if account[5..-1].to_i < 1000
      unless account[5] == "0"
        if account[2..5] == "5046"
          if ["0", "1", "4", "5", "6", "7", "8"].include?(account[6])
            raise "For this account there is no IBAN (Bundesbank 2)" if account[5..-1].to_i < 1000
          end
        end
      end
    end
    blz, account
  end

  # 004700 Santander Consumer Bank
  # Bei der Ermittlung von IBAN und BIC aus Kontonummer und BLZ sind in Abwei- chung zu der Standard IBAN-Regel folgende Besonderheiten zu beachten:
  # Achtstellige Kontonummern sind rechtsbündig mit Nullen aufzufüllen.
  # Alle anderen Kontonummern mit weniger als zehn Stellen werden nach der Standard- Regel linksbündig mit Nullen aufgefüllt.
  def santander_consumer_bank(blz, account)
    blzs_santander_consumer_bank = ["10033300", "20133300", "36033300", "50033300", "55033300", "60133300", "70133300", "86033300"]
    if blzs_santander_consumer_bank.include?(blz) && account[0..1] == "00" && account[2] != "0"
      account = account[2..-1] + "00"
    end
    blz, account
  end

  # 004900 WGZ Bank
  # 1. Für die Bankleitzahlen 300 600 10, 400 600 00 und 570 600 00 der WGZ Bank ist die IBAN-Ermittlung für Kontonummern mit der 5. Stelle ungleich '9' (standardmäßig links mit Nullen auf 10 Stellen aufgefüllt) mit der Standard-IBAN-Regel möglich.
  # Für Kontonummern mit einer '9' an der 5. Stelle muss die Kontonummer, auf deren Ba- sis die IBAN ermittelt wird, abweichend berechnet werden. Die ersten 4 Stellen (inkl. aufgefüllter Nullen) müssen ans Ende gestellt werden, so dass die Kontonummer dann immer mit der '9' anfängt.
  # Beispiel:
  # Kontonummer alt: 0001991182 Kontonummer für die Berechnung der IBAN: 9911820001
  # Diese neu ermittelte Kontonummer hat keine Prüfziffer, die daher auch nicht geprüft werden darf. Ansonsten kann mit dieser Kontonummer die IBAN mit der Standard-IBAN-Regel ermittelt werden.
  # Test-IBAN korrekt: DE26 3006 0010 9911 8200 01 Test-IBAN falsch: DE19 3006 0010 0001 9911 82
  def self.wgz_bank(blz, account)
    blzs_wgz_bank = ["30060010", "40060000", "57060000"]
    if blzs_wgz_bank.include?(blz) && account[4] == "9"
      account = account[4..-1] + account[0..3]
    end
    blz, account
  end

  # 005200 Landesbank Baden-Württemberg/ Baden-Württembergische Bank
  # Für die Ermittlung der IBAN aus Bankleitzahl und Kontonummer gilt für die Lan- desbank Baden-Württemberg/BW-Bank die IBAN-Regel 0001 00 (keine IBAN- Berechnung).
  # Ausnahme: (In Replace aufgeführt)
  def self.landesbank_baden_wuerttemberg(blz, account)
    blzs_landesbank = ["62030050", "63020130", "64020030", "64120030", "66620020", "67020020", "67220020", "69220020", "69421020"]
    if blzs_landesbank.include?(blz)
      raise "For this account there is no IBAN (landesbank_baden_wuerttemberg)" if account[5..-1].to_i < 1000
    end
    blz, account
  end

  # 003600 HSH Nordbank AG
  def self.hsh_nordbank(blz, account)
    if blz == "21050000"
      raise "For this account there is no IBAN (HSH1)" if account.to_i < 100000
      raise "For this account there is no IBAN (HSH2)" if account.to_i < 30000000 && account.to_i >= 900000
      raise "For this account there is no IBAN (HSH3)" if account.to_i < 100000000 && account.to_i >= 60000000
      raise "For this account there is no IBAN (HSH4)" if account.to_i < 1000000000 && account.to_i >= 900000000
      raise "For this account there is no IBAN (HSH5)" if account.to_i < 3000000000 && account.to_i >= 2000000000
      raise "For this account there is no IBAN (HSH6)" if account.to_i < 8500000000 && account.to_i >= 7100000000
      raise "For this account there is no IBAN (HSH7)" if account.to_i < 9000000000 && account.to_i >= 8600000000
      if account[0..3] == "0000" && account[4] != "0"
        account = account[3..-1] + "000"
      end
    end
    blz, account
  end

  #0032-0035
  def self.unicredit(blz, account)
    # oldblz => [[account start, account end, newblz]]
    exHypoTable = {"25120960"=>[[4060000000,4069999999,"48020086"]],"66220562"=>[[4100000000,4109999999,"66020286"]],"74020414"=>[[6720000000,6729999999,"74020074"]],"76020214"=>[[1000000000,1009999999,"76020070"],[1040000000,1049999999,"76320072"],[1100000000,1109999999,"76220073"],[1110000000,1119999999,"76020070"],[1130000000,1139999999,"76020070"],[1140000000,1149999999,"76020070"],[1150000000,1159999999,"76520071"],[1180000000,1189999999,"76020070"],[1220000000,1229999999,"76320072"],[1230000000,1239999999,"76420080"],[1240000000,1249999999,"76320072"],[1350000000,1359999999,"77020070"],[1480000000,1489999999,"76520071"],[1500000000,1509999999,"76020070"],[1510000000,1519999999,"76320072"],[1550000000,1559999999,"76520071"],[1560000000,1569999999,"76020070"],[1900000000,1909999999,"76020070"],[1940000000,1949999999,"76020070"],[1980000000,1989999999,"76320072"],[2010000000,2019999999,"76020070"],[2020000000,2029999999,"76020070"],[2030000000,2039999999,"76020070"],[2040000000,2049999999,"76020070"],[2370000000,2379999999,"76020070"],[2410000000,2419999999,"76220073"],[2880000000,2889999999,"75220070"],[2920000000,2929999999,"76020070"],[3130000000,3139999999,"76320072"],[3210000000,3219999999,"75220070"],[3300000000,3309999999,"76020070"],[3460000000,3469999999,"76020070"],[3590000000,3599999999,"76220073"],[3690000000,3699999999,"76520071"],[4240000000,4249999999,"76020070"],[4350000000,4359999999,"76020070"],[4360000000,4369999999,"76020070"],[4720000000,4729999999,"76020070"],[6900000000,6909999999,"76520071"],[7140000000,7149999999,"76020070"]],"10120760"=>[[1010000000,1019999999,"10020890"],[1570000000,1579999999,"10020890"],[2090000000,2099999999,"18020086"],[2100000000,2109999999,"10020890"],[2540000000,2549999999,"10020890"],[2600000000,2609999999,"10020890"],[2790000000,2799999999,"10020890"],[3410000000,3419999999,"10020890"],[3420000000,3429999999,"10020890"],[3680000000,3689999999,"10020890"],[4090000000,4099999999,"10020890"],[4560000000,4569999999,"10020890"],[4660000000,4669999999,"10020890"],[4670000000,4679999999,"10020890"],[7120000000,7129999999,"10020890"]],"78020429"=>[1020000000,1029999999,"78320076"],[1080000000,1089999999,"77320072"],[1170000000,1179999999,"77120073"],[1190000000,1199999999,"75320075"],[1260000000,1269999999,"77320072"],[1270000000,1279999999,"78020070"],[1280000000,1289999999,"78020070"],[1290000000,1299999999,"77120073"],[1300000000,1309999999,"78020070"],[1310000000,1319999999,"78020070"],[1340000000,1349999999,"78020070"],[1520000000,1529999999,"78320076"],[1810000000,1819999999,"77320072"],[1910000000,1919999999,"77020070"],[2400000000,2409999999,"75320075"],[2910000000,2919999999,"77320072"],[3450000000,3459999999,"77020070"],[4760000000,4769999999,"78320076"],[6820000000,6829999999,"78020070"],[7230000000,7239999999,"77320072"],"79320432"=>[[1030000000,1039999999,"79320075"],[1060000000,1069999999,"79320075"],[1070000000,1079999999,"79320075"],[1090000000,1099999999,"79320075"],[1120000000,1129999999,"79320075"],[1370000000,1379999999,"79320075"],[2580000000,2589999999,"79320075"],[2840000000,2849999999,"79320075"],[3500000000,3509999999,"79320075"],[3510000000,3519999999,"79320075"]],"79020325"=>[[1050000000,1059999999,"79020076"],[1210000000,1219999999,"76220073"],[1400000000,1409999999,"79020076"],[1440000000,1449999999,"79020076"],[1490000000,1499999999,"79020076"],[1690000000,1699999999,"79020076"],[1860000000,1869999999,"79020076"],[2170000000,2179999999,"79020076"],[4710000000,4719999999,"84020087"]],"72120207"=>[[1200000000,1209999999,"72120078"],[1460000000,1469999999,"72120078"],[1750000000,1759999999,"72120078"],[2300000000,2309999999,"72120078"],[2450000000,2459999999,"72120078"],[3340000000,3349999999,"75020073"],[6370000000,6379999999,"72120078"],[6480000000,6489999999,"72120078"],[6490000000,6499999999,"72122181"],[6550000000,6559999999,"72120078"],[6640000000,6649999999,"72120078"]],"79520533"=>[[1250000000,1259999999,"79520070"],[1360000000,1369999999,"79520070"],[1820000000,1829999999,"79520070"],[2050000000,2059999999,"79520070"],[2060000000,2069999999,"79520070"],[2190000000,2199999999,"79520070"],[3220000000,3229999999,"79520070"],[3820000000,3829999999,"79520070"]],"60120050"=>[[1320000000,1329999999,"60020290"],[1380000000,1389999999,"61120286"],[1390000000,1399999999,"66020286"],[1420000000,1429999999,"64020186"],[1430000000,1439999999,"60020290"],[2110000000,2119999999,"60020290"],[4110000000,4119999999,"60420186"],[4340000000,4349999999,"60020290"],[4590000000,4599999999,"61120286"],[4690000000,4699999999,"60320291"]],"66020150"=>[[1450000000,1459999999,"66020286"]],"72020240"=>[[1470000000,1479999999,"72223182"],[1960000000,1969999999,"72020070"],[2310000000,2319999999,"72020070"],[2430000000,2439999999,"72020070"],[2620000000,2629999999,"72020070"],[2830000000,2839999999,"72020070"],[2930000000,2939999999,"72020070"],[2990000000,2999999999,"72020070"],[3100000000,3109999999,"72020070"],[3270000000,3279999999,"72020070"],[3280000000,3289999999,"72020070"],[3540000000,3549999999,"72223182"],[3550000000,3559999999,"72020070"],[3660000000,3669999999,"72220074"],[3830000000,3839999999,"72020070"],[3840000000,3849999999,"72020070"],[6770000000,6779999999,"72020070"],[6780000000,6789999999,"72020070"]],"70020001"=>[[1540000000,1549999999,"70020270"],[1580000000,1589999999,"70020270"],[1600000000,1609999999,"70020270"],[1620000000,1629999999,"70020270"],[1630000000,1639999999,"70020270"],[1640000000,1649999999,"70020270"],[1660000000,1669999999,"71120078"],[1700000000,1709999999,"70020270"],[1720000000,1729999999,"70020270"],[1740000000,1749999999,"70020270"],[1780000000,1789999999,"70020270"],[1830000000,1839999999,"70020270"],[1850000000,1859999999,"70020270"],[1880000000,1889999999,"70020270"],[1890000000,1899999999,"70020270"],[1920000000,1929999999,"70025175"],[1990000000,1999999999,"70020270"],[2070000000,2079999999,"71120078"],[2280000000,2289999999,"71120078"],[2330000000,2339999999,"71020072"],[2340000000,2349999999,"71022182"],[2360000000,2369999999,"71022182"],[2390000000,2399999999,"70020270"],[2460000000,2469999999,"74320073"],[2510000000,2519999999,"70020270"],[2520000000,2529999999,"70020270"],[2530000000,2539999999,"70020270"],[2560000000,2569999999,"71022182"],[2590000000,2599999999,"71120077"],[2610000000,2619999999,"70025175"],[2690000000,2699999999,"71122183"],[2760000000,2769999999,"70020270"],[2780000000,2789999999,"71120077"],[2810000000,2819999999,"71120078"],[2820000000,2829999999,"70020270"],[2870000000,2879999999,"70020270"],[2950000000,2959999999,"70020270"],[2960000000,2969999999,"70020270"],[3040000000,3049999999,"70020270"],[3080000000,3089999999,"70020270"],[3140000000,3149999999,"70020270"],[3150000000,3159999999,"70020270"],[3160000000,3169999999,"70020270"],[3170000000,3179999999,"70020270"],[3180000000,3189999999,"70020270"],[3200000000,3209999999,"71022182"],[3240000000,3249999999,"70020270"],[3290000000,3299999999,"70020270"],[3310000000,3319999999,"70020270"],[3330000000,3339999999,"70020270"],[3350000000,3359999999,"70020270"],[3440000000,3449999999,"70020270"],[3520000000,3529999999,"70020270"],[3530000000,3539999999,"70020270"],[3560000000,3569999999,"70020270"],[3610000000,3619999999,"70020270"],[3620000000,3629999999,"70020270"],[3630000000,3639999999,"70020270"],[3670000000,3679999999,"70020270"],[3710000000,3719999999,"70020270"],[3730000000,3739999999,"70020270"],[3750000000,3759999999,"70020270"],[3790000000,3799999999,"70020270"],[3800000000,3809999999,"70020270"],[3810000000,3819999999,"70020270"],[3860000000,3869999999,"70020270"],[3870000000,3879999999,"70020270"],[3890000000,3899999999,"70020270"],[3910000000,3919999999,"70020270"],[3920000000,3929999999,"70020270"],[3940000000,3949999999,"70020270"],[3960000000,3969999999,"70020270"],[4010000000,4019999999,"30220190"],[4220000000,4229999999,"70020270"],[4230000000,4239999999,"70020270"],[4260000000,4269999999,"70025175"],[4280000000,4289999999,"70020270"],[4320000000,4329999999,"70020270"],[4370000000,4379999999,"70020270"],[4380000000,4389999999,"70020270"],[4390000000,4399999999,"70020270"],[4400000000,4409999999,"70020270"],[4410000000,4419999999,"70020270"],[4470000000,4479999999,"70020270"],[4520000000,4529999999,"70020270"],[4530000000,4539999999,"70020270"],[4600000000,4609999999,"70020270"],[4610000000,4619999999,"70020270"],[4620000000,4629999999,"70020270"],[4630000000,4639999999,"70020270"],[4650000000,4659999999,"70020270"],[4680000000,4689999999,"70020270"],[4800000000,4809999999,"70020270"],[4810000000,4819999999,"70020270"],[6260000000,6269999999,"71020072"],[6270000000,6279999999,"71021270"],[6280000000,6289999999,"71120077"],[6300000000,6309999999,"71121176"],[6310000000,6319999999,"71022182"],[6320000000,6329999999,"70020270"],[6330000000,6339999999,"74320073"],[6340000000,6349999999,"70020270"],[6400000000,6409999999,"70020270"],[6410000000,6419999999,"70020270"],[6440000000,6449999999,"70020270"],[6450000000,6459999999,"70020270"],[6460000000,6469999999,"70020270"],[6470000000,6479999999,"70020270"],[6530000000,6539999999,"70020270"],[6540000000,6549999999,"70020270"],[6560000000,6569999999,"71120078"],[6570000000,6579999999,"71020072"],[6800000000,6809999999,"71120077"],[6830000000,6839999999,"71020072"],[6840000000,6849999999,"70020270"],[6850000000,6859999999,"70020270"],[6860000000,6869999999,"70020270"],[6870000000,6879999999,"70020270"],[6880000000,6889999999,"70020270"],[6890000000,6899999999,"70020270"],[6920000000,6929999999,"70020270"],[6940000000,6949999999,"70021180"],[7110000000,7119999999,"70020270"],[7150000000,7159999999,"75020073"],[7170000000,7179999999,"74320073"],[7980000000,7989999999,"70020270"]],"54020474"=>[[1590000000,1599999999,"54520194"],[6970000000,6979999999,"54020090"]],"54520071"=>[[1610000000,1619999999,"54520194"],[2180000000,2189999999,"59020090"],[3020000000,3029999999,"54520194"],[3930000000,3939999999,"54520194"],[4580000000,4589999999,"54520194"],[6500000000,6509999999,"54520194"],[6790000000,6799999999,"54520194"]],"75020314"=>[[1670000000,1679999999,"74320073"],[2140000000,2149999999,"75020073"],[2160000000,2169999999,"75020073"],[2270000000,2279999999,"75020073"],[2320000000,2329999999,"75021174"],[2710000000,2719999999,"75020073"],[6700000000,6709999999,"75020073"],[6710000000,6719999999,"74220075"]],"74320307"=>[[1670000000,1679999999,"74320073"],[1760000000,1769999999,"74020074"],[1770000000,1779999999,"74320073"],[2230000000,2239999999,"74320073"],[2250000000,2259999999,"74020074"],[2350000000,2359999999,"74320073"],[2640000000,2649999999,"74020074"],[2770000000,2779999999,"74320073"],[4730000000,4739999999,"74020074"],[6380000000,6389999999,"72120078"],[6430000000,6439999999,"74320073"],[6520000000,6529999999,"71021270"],[6610000000,6619999999,"74320073"],[6730000000,6739999999,"74020074"],[6750000000,6759999999,"74020074"],[6760000000,6769999999,"74020074"],[6960000000,6969999999,"74320073"]],"70320305"=>[[1680000000,1689999999,"70320090"],[2220000000,2229999999,"73421478"],[2680000000,2689999999,"70320090"],[6350000000,6359999999,"70320090"],[6360000000,6369999999,"70320090"],[6630000000,6639999999,"70322192"],[6650000000,6659999999,"70321194"],[6950000000,6959999999,"70320090"]],"85020890"=>[[1930000000,1939999999,"85020086"],[2480000000,2489999999,"85020086"],[3010000000,3019999999,"85020086"],[3260000000,3269999999,"85020086"],[3700000000,3709999999,"85020086"],[4290000000,4299999999,"85020086"],[4420000000,4429999999,"85020086"]],"73420546"=>[[2080000000,2089999999,"73120075"],[2240000000,2249999999,"73322380"],[2500000000,2509999999,"73420071"],[2720000000,2729999999,"73420071"],[3740000000,3749999999,"73120075"],[6930000000,6939999999,"73420071"],[6980000000,6989999999,"73320073"]],"50020160"=>[[2120000000,2129999999,"51020186"],[2550000000,2559999999,"50820292"],[4120000000,4129999999,"57020086"],[4270000000,4279999999,"50320191"],[4430000000,4439999999,"55020486"],[4440000000,4449999999,"50520190"],[7100000000,7109999999,"30220190"]],"63020450"=>[[2150000000,2159999999,"63020086"],[2210000000,2219999999,"73120075"],[2380000000,2389999999,"63020086"],[2670000000,2679999999,"63020086"],[2740000000,2749999999,"63020086"],[6290000000,6299999999,"73120075"],[6620000000,6629999999,"73120075"]],"73320442"=>[[2200000000,2209999999,"73322380"],[2470000000,2479999999,"60020290"],[2490000000,2499999999,"73321177"],[4700000000,4709999999,"65020186"],[6660000000,6669999999,"73322380"],[6670000000,6679999999,"60020290"],[6680000000,6689999999,"60020290"],[6690000000,6699999999,"73320073"]],"86020880"=>[[2290000000,2299999999,"80020086"],[2570000000,2579999999,"83020086"],[2700000000,2709999999,"82020086"],[3370000000,3379999999,"80020086"],[3600000000,3609999999,"80020087"],[3990000000,3999999999,"87020088"],[4460000000,4469999999,"80020086"],[4570000000,4579999999,"87020086"],[4770000000,4779999999,"78320076"],[4780000000,4789999999,"87020088"],[7180000000,7189999999,"87020086"],[7330000000,7339999999,"83020087"]],"54220576"=>[[2860000000,2869999999,"54520194"],[3580000000,3589999999,"54220091"]],"54620574"=>[[2940000000,2949999999,"54520194"],[6600000000,6609999999,"54620093"],[3090000000,3099999999,"54520194"],[3980000000,3989999999,"66020286"],[6590000000,6599999999,"54520194"]],"74120514"=>[[3120000000,3129999999,"74120071"],[6740000000,6749999999,"74120071"]],"67020259"=>[[3900000000,3909999999,"67020190"],[6810000000,6819999999,"67020190"]],"30120764"=>[[4020000000,4029999999,"36020186"],[4030000000,4039999999,"38020090"],[4040000000,4049999999,"30220190"],[4070000000,4079999999,"37020090"],[4500000000,4509999999,"30220190"],[4510000000,4519999999,"44020090"],[7190000000,7199999999,"37020090"],[7200000000,7209999999,"30220190"]],"68020460"=>[[4050000000,4059999999,"68020186"],[4080000000,4089999999,"68020186"],[6580000000,6589999999,"68020186"]]}
    #rule 003101
    if account[0] != "0" && KontoCheck.bank_loeschung(blz) == 1
      account_areas_and_new_blz = exHypoTable[blz]
      if account_areas_and_new_blz
        account_areas_and_new_blz.each do |a|
          if account.to_i >= a[0] && account.to_i <= a[1]
            blz = a[2]
          end
        end
      end
    end
    #rule 0032-00
    if account_areas_and_new_blz && KontoCheck.bank_loeschung(blz) == 0 && blz != "70020270"
      raise "For this account there is no IBAN (Unicredit0032-00)" if account.to_i >= 800000000 && account.to_i < 900000000
    end
    blz, account
  end

 # 0005
  def self.commerzbank(blz, account)
    maybe_invalid_blzs = ["10080900","25780022","42080082","54280023","65180005","79580099","12080000","25980027","42680081","54580020","65380003","80080000","13080000","26080024","43080083","54680022","66280053","81080000","14080000","26281420","44080055","55080065","66680013","82080000","15080000","26580070","44080057","57080070","67280051","83080000","16080000","26880063","44580070","58580074","69280035","84080000","17080000","26981062","45080060","59080090","70080056","85080200","18080000","28280012","46080010","60080055","70080057","86080055","20080055","29280011","47880031","60080057","70380006","86080057","20080057","30080055","49080025","60380002","71180005","87080000","21080050","30080057","50080055","60480008","72180002","21280002","31080015","50080057","61080006","73180011","21480003","32080010","50080082","61281007","73380004","21580000","33080030","50680002","61480001","73480013","22180000","34080031","50780006","62080012","74180009","22181400","34280032","50880050","62280012","74380007","22280000","36280071","51380040","63080015","75080003","24080000","36580072","52080080","64080014","76080053","24180001","40080040","53080030","64380011","79080052","25480021","41280043","54080021","65080009","79380051"]
    if maybe_invalid_blzs.include?(blz)
      raise "For this account there is no IBAN (Commerzbank)" if account.to_i >= 998000000 && account.to_i < 9994500000
    end
  end

  # commerzbank 0005
  def self.method_13_adeptions(blz, account)
    if KontoCheck.bank_pz(blz) == 13 && account[0..3] == "0000"
      account = "00" + account[4..-1] + "00"
    end
    blz, account
  end

  # commerzbank 0005
  def self.method_63_adeptions(blz, account)
    if KontoCheck.bank_pz(blz) == 63
      raise "For this account there is no IBAN (Method63-1)" if account[0..5] == "000000"
      if account[0..3] == "0000"
        account = "00" + account[4..-1] + "00"
      end
      if account[0..2] == "000"
        account = "0" + account[4..-1] + "000"
      end
        
      end
    end
    blz, account
  end

  # deutsche bank 0020
  def self.method_76_adeptions(blz, account)
    if KontoCheck.bank_pz(blz) == 76 && account[0..1] == "00"
      account = account[2..-1] + "00"
    end
    blz, account
  end

end